# DDD的学习

## 软件开发的本质

​	选取合适的技术、花费一定的资源、在可复制的流程里满足特定的市场需求，得到相应的利润。需要兼顾三方的需求：

* 市场：需求、业务逻辑和体验、利润来源。
* 工程：资源规划、流程规范、追求效率。
* 技术：非业务需求、更新换代和解决问题（引入问题）、架构设计

![image-20220108212446943](ddd的学习/image-20220108212446943.png)

## DDD概述

​	Domain Driven Design ( DDD)是一种应对软件复杂的设计方法论，提倡聚焦业务领域而非技术，合理规划业务和技术的依赖，从而达到一种稳定的领域模型，从而应对多变的业务需求。

## DDD的思量

DDD要求从软件开发的市场、技术、工程三个方面通盘考虑。

* 需求元素
  * 基于需求提炼领域知识、领域建模、聚焦业务

* 架构元素
  * 用整洁分层的技术架构指导开发、解耦业务和技术
* 工程元素
  * 强调面向对象设计规范，坚持四重边界

### 需求元素---业务复杂性

​	下图概括了复杂软件的扩展方向：

* X轴：服务/数据水平复制（当请求量变大的时候，可以通过集群、或者负载均衡去扩展）
* Y轴：职责/功能划分（对不同的业务进行不同的拆分，例如分库分表，经常用的数据拆分到处理性能高的地方）
* Z轴：服务/数据优先级划分（没有通用解决方案，DDD算是这里的一个解决方法）

![image-20220108221811034](ddd的学习/image-20220108221811034.png)

### 架构元素

#### 软件架构的演变

​	拆分--->内聚--->结构化依赖解耦--->扩展

业务拆分：

* 业务拆分：SAAS（MVC、SSM分层）--->DDD分层
* 技术复用：PAAS（SOA、微服务、云原生、mesh、异地多活）
* 屏蔽OS：IAAS(VM、Docker、K8S)

介绍一下SAAS/PAAS/IAAS

* IASS就是提供硬件支持的，提供烤披萨的炉子，餐具，灶具。（代表：阿里云）

* PAAS就是提供平台服务,提供烤披萨的炉子，餐具，饼皮。（代表：百度云、新浪云）
* SAAS就是直接提供服务，提供平台服务,你去店里直接买披萨（代表：QQ、PayPal）

![image-20220108230846284](ddd的学习/image-20220108230846284.png)

#### DDD的架构范畴

* 业务架构
  * 静态：业务域、业务模块、平台化
  * 动态：业务流程、核心流程

* 应用架构
  * 分合：按业务拆、按技术合
  * 模块化：服务内模块化

* 服务架构
  * 服务治理：注册发现，容错，链路

* 数据架构：数据定义、存储、治理
* 物理架构：硬件治理（机房、集群、服务器）
* 运维架构：部署、伸缩、监控、安全

特别注意：关注业务架构，因为需要对业务进行抽象！

![image-20220108230615827](ddd的学习/image-20220108230615827.png)

#### DDD架构的演变

**分层架构**

​	最早出现的DDD相关的架构，由Eric Evans 2003年提出，也是大家俗称的分层架构。这种架构的特点是提出把代码按照DDD的概念做了分层归属，特别是应用服务层和领域层是DDD特有的概念。这里拿MVC举例：

* User Interface Layer：相当于以前的M层，写controller和前端进行交互
* Application Layer：相当于Service层，DDD里着重把Service层进行了拆分。
* Domain Layer：相当于Service层，DDD里着重把Service层进行了拆分。
* Infrastructure Layer：相当于dao层，运用于和db打交道。

​	原因：业务越来越复杂，进行服务拆分的时候越来越麻烦，从而进行了引进。

缺点：领域层和Infrastructure Layer还是存在依赖关系。

![img](DDD的学习/format,png.png)

**六边形架构**

​	2005年Alistair Cockburn提出的接口&适配器架构，Alistair Cockburn一开始提出的端口适配器架构，并没有融入太多DDD特色的应用服务层和领域层。它只是笼统的分为内层的业务逻辑层和外层的输入输出相关的适配层。其中适配层又可细分为主动适配层和被动适配层。

* 内层六边形：应用程序、领域模型
* 外层六边形：主要由适配器组成，接口编程，就是controller层

优点：因为环境已经和db还有外层测试环境进行了隔离，所以测试起业务可以直接测试，非常方便。 

![img](DDD的学习/1135193-20210531121458344-516091878.png)

**洋葱架构**

​	洋葱架构的特点是围绕独立的领域模型构建应用，内层定义接口，外层实现接口，依赖的方向指向圆心

![img](DDD的学习/1135193-20210531121430499-290088953.png)

**整洁架构**

​	整洁架构跟洋葱架构基本一样，只是层次上的叫法没有完全遵循DDD概念。（越内层，越关注业务）

![image-20220109171115601](DDD的学习/image-20220109171115601.png)

**CQRS（读写分离架构）**

​	CQRS一般结合event sourcing一起使用，是一种读写分离架构，命令类型负责产生和修改数据，查询类型负责读取数据。

缺点：实时性和一致性存在问题，因为写入的时候，可能读取存在延迟。

![image-20220109173247009](DDD的学习/image-20220109173247009.png)

**核心域、通用域和支撑域**

>领域会细分为不同的子域，子域可以根据自身重要性和功能属性划分为三类子域，它们分别是：核心域、通用域和支撑域。
>
>决定产品和公司核心竞争力的子域是核心域，它是业务成功的主要因素和公司的核心竞争力。
>
>没有太多个性化的诉求，同时被多个子域使用的通用功能子域是通用域。
>
>还有一种功能子域是必需的，但既不包含决定产品和公司核心竞争力的功能，也不包含通用功能的子域，它就是支撑域。
>
>    这三类子域相较之下，核心域是最重要的，通用域和支撑域如果对应到企业系统，举例来说的话，通用域则是你需要用到的通用系统，比如认证、权限等等，这类应用很容易买到，没有企业特点限制，不需要做太多的定制化。而支撑域则具有企业特性，但不具有通用性，例如数据代码类的数据字典等系统。
>
>    还是拿上图的桃树来说。我们将桃树细分为了根、茎、叶、花、果实和种子等六个子域，那桃树是否有核心域？有的话，到底哪个是核心域呢？
>
>不同的人对桃树的理解是不同的。如果这棵桃树生长在公园里，在园丁的眼里，他喜欢的是“人面桃花相映红”的阳春三月，这时花就是桃树的核心域。但如果这棵桃树生长在果园里，对果农来说，他则是希望在丰收的季节收获硕果累累的桃子，这时果实就是桃树的核心域。在不同的场景下，不同的人对桃树核心域的理解是不同的，因此对桃树的处理方式也会不一样。园丁更关注桃树花期的营养，而果农则更关注桃树落果期的营养，有时为了保证果实的营养供给，还会裁剪掉疯长的茎和叶（通用域或支撑域）。
>
>同样的道理，公司在 IT 系统建设过程中，由于预算和资源有限，对不同类型的子域应有不同的关注度和资源投入策略，好钢要用在刀刃上。
>
>![在这里插入图片描述](DDD的学习/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0Rlc3Rpbnlfc2hpbmU=,size_16,color_FFFFFF,t_70#pic_center.png)
>
>**领域拆分为子领域就是做减法的过程，降低了业务的理解复杂度和系统实现的复杂度，而核心域，通用域，支撑域的划分是跟公司的商业模式有关系的，决定了子领域的不同优先级和资源投入策略。**

